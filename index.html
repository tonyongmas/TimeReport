<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô(‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏®‡∏Å‡∏¥‡∏à)‡∏ó‡∏ï.‡∏ï‡∏±‡∏ô‡∏´‡∏¢‡∏á‡∏°‡∏±‡∏™</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
        .btn-select { transition: all 0.2s; border: 2px solid transparent; opacity: 0.7; transform: scale(0.95); }
        .btn-select.active { border-color: #3b82f6; opacity: 1; transform: scale(1); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-20">

    <div class="bg-white shadow-sm p-4 text-center sticky top-0 z-20">
        <div class="flex flex-col items-center justify-center">
            <img src="https://img2.pic.in.th/pic/71f81565dc59a7f9545542493a5514ab.png" alt="Logo" class="w-auto h-16 mb-2 object-contain">
            <h1 class="text-lg font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡∏®‡∏Å‡∏¥‡∏à ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ï‡∏≥‡∏ö‡∏•‡∏ï‡∏±‡∏ô‡∏´‡∏¢‡∏á‡∏°‡∏±‡∏™</p>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4 space-y-4">

        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            <label class="block text-gray-700 mb-2 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</label>
            <div class="relative">
                <select id="employeeSelect" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-700">
                    <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠...</option>
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">‚ñº</div>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            <label class="block text-gray-700 mb-3 font-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
            <div class="grid grid-cols-3 gap-3">
                <button onclick="selectType('‡πÄ‡∏ä‡πâ‡∏≤', this)" class="btn-select bg-green-100 text-green-700 py-3 rounded-lg font-medium flex flex-col items-center">
                    <span>‚òÄÔ∏è</span><span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡πÄ‡∏ä‡πâ‡∏≤</span>
                </button>
                <button onclick="selectType('‡∏ö‡πà‡∏≤‡∏¢', this)" class="btn-select bg-orange-100 text-orange-700 py-3 rounded-lg font-medium flex flex-col items-center">
                    <span>üå§</span><span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ö‡πà‡∏≤‡∏¢</span>
                </button>
                <button onclick="selectType('‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', this)" class="btn-select bg-red-100 text-red-700 py-3 rounded-lg font-medium flex flex-col items-center">
                    <span>üì¢</span><span>‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</span>
                </button>
            </div>

            <div id="complaintBox" class="hidden mt-4 animate-fade-in-down">
                <label class="text-sm text-gray-500 mb-1 block">‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤:</label>
                <textarea id="complaintDetail" rows="3" class="w-full p-3 border border-red-200 rounded-lg bg-red-50 focus:outline-none focus:border-red-400 placeholder-red-300" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            <label class="block text-gray-700 mb-2 font-semibold">‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS</label>
            <div class="flex gap-2">
                <input type="text" id="gpsInput" readonly class="flex-1 p-3 bg-gray-100 rounded-lg text-gray-500 text-sm font-mono border border-gray-200" placeholder="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î">
                <button onclick="getLocation()" id="btnGPS" class="bg-blue-600 hover:bg-blue-700 text-white px-4 rounded-lg shadow transition flex items-center justify-center gap-1 min-w-[100px]">
                    üìç <span id="gpsLabel">‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î</span>
                </button>
            </div>
        </div>

        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            <label class="block text-gray-700 mb-2 font-semibold">‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢</label>
            <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden" onchange="previewImage(this)">
            <div onclick="document.getElementById('cameraInput').click()" 
                 class="border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 h-48 flex flex-col items-center justify-center cursor-pointer hover:bg-gray-100 transition relative overflow-hidden group">
                <div id="cameraIcon" class="text-center group-hover:scale-105 transition">
                    <div class="text-4xl mb-2 opacity-50">üì∏</div>
                    <span class="text-sm text-gray-500">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</span>
                </div>
                <img id="preview" class="hidden w-full h-full object-cover absolute inset-0">
            </div>
        </div>

        <button onclick="submitData()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-4 rounded-xl shadow-lg font-bold text-lg hover:shadow-xl transform active:scale-95 transition mt-4">
            üöÄ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        </button>

    </div>

    <script>
        // ******************************************************
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà URL Web App ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        // ******************************************************
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzz8WfnnTgUKlv2I2c-cQ627aLzyrfNRcawmSrjNC97szsZzLuL-a0zb4W-Xx12mFBv/exec';

        let base64Image = "";
        let selectedType = "";

        window.onload = loadEmployees;

        function loadEmployees() {
            fetch(SCRIPT_URL + '?op=getEmployees')
                .then(res => res.json())
                .then(data => {
                    const select = document.getElementById('employeeSelect');
                    if (data.status === 'error') throw new Error(data.message);
                    select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>';
                    data.forEach(name => {
                        const opt = document.createElement('option');
                        opt.value = name; opt.innerText = name;
                        select.appendChild(opt);
                    });
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('employeeSelect').innerHTML = '<option>‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>';
                });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
        function selectType(type, btn) {
            selectedType = type;
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.querySelectorAll('.btn-select').forEach(b => {
                b.classList.remove('active', 'ring-2', 'ring-blue-500');
            });

            // Active ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            btn.classList.add('active', 'ring-2', 'ring-blue-500');

            // ‡πÇ‡∏ä‡∏ß‡πå/‡∏ã‡πà‡∏≠‡∏ô ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤
            const box = document.getElementById('complaintBox');
            if (type === '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô') {
                box.classList.remove('hidden');
            } else {
                box.classList.add('hidden');
                document.getElementById('complaintDetail').value = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á GPS
        function getLocation() {
            const btn = document.getElementById('btnGPS');
            const label = document.getElementById('gpsLabel');
            
            btn.disabled = true;
            label.innerHTML = '<div class="loader"></div>'; // ‡∏´‡∏°‡∏∏‡∏ô‡πÜ

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        document.getElementById("gpsInput").value = `${lat}, ${lng}`;
                        
                        // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
                        btn.classList.remove('bg-blue-600');
                        btn.classList.add('bg-green-500');
                        label.innerText = '‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
                        btn.disabled = false;
                    },
                    (error) => {
                        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á GPS ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Location Service");
                        label.innerText = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                        btn.disabled = false;
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                alert("Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS");
                btn.disabled = false;
            }
        }

        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 5 * 1024 * 1024) return alert("‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB");

                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('preview').src = e.target.result;
                    document.getElementById('preview').classList.remove('hidden');
                    document.getElementById('cameraIcon').classList.add('hidden');
                    base64Image = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        function submitData() {
            const name = document.getElementById('employeeSelect').value;
            const gps = document.getElementById('gpsInput').value;
            let details = "";

            // Validation
            if (!name) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', 'warning');
            if (!selectedType) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏á‡∏≤‡∏ô', 'warning');
            
            if (selectedType === '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô') {
                details = document.getElementById('complaintDetail').value;
                if (!details) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤', 'warning');
            }

            if (!gps) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS', 'warning');
            if (!base64Image) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô', 'warning');

            // ‡πÅ‡∏™‡∏î‡∏á Loading ‡πÅ‡∏ö‡∏ö‡∏™‡∏ß‡∏¢‡πÜ
            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading() }
            });

            const payload = {
                employee: name,
                type: selectedType,
                details: details,
                gps: gps,
                image: base64Image
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if(data.status === 'success'){
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                        text: '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß',
                        timer: 2000,
                        showConfirmButton: false
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(err => {
                Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
            });
        }
    </script>
</body>
</html>
