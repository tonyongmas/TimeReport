<div class="card">
    <h3>เพิ่มข้อมูลใหม่</h3>
    <form id="myForm">
        <label>ชื่อ:</label><br>
        <input type="text" name="name" required placeholder="ใส่ชื่อที่นี่"><br><br>
        
        <label>อีเมล:</label><br>
        <input type="email" name="email" required placeholder="example@mail.com"><br><br>
        
        <button type="submit" id="btnSubmit">บันทึกข้อมูล</button>
    </form>
</div>

<script>
    // URL เดิมของคุณ
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzz8WfnnTgUKlv2I2c-cQ627aLzyrfNRcawmSrjNC97szsZzLuL-a0zb4W-Xx12mFBv/exec';

    const form = document.getElementById('myForm');
    const btn = document.getElementById('btnSubmit');

    form.addEventListener('submit', e => {
        e.preventDefault(); // ป้องกันไม่ให้หน้าเว็บรีเฟรช
        
        // 1. เปลี่ยนปุ่มเป็นสถานะกำลังโหลด
        btn.innerText = 'กำลังบันทึก...';
        btn.disabled = true;

        // 2. ดึงค่าจากฟอร์มสร้างเป็น Object
        const formData = new FormData(form);
        const data = Object.fromEntries(formData); 

        // 3. ส่งข้อมูลด้วย fetch (POST)
        fetch(SCRIPT_URL, {
            method: 'POST',
            // เทคนิค: ส่งแบบ text/plain เพื่อหลีกเลี่ยงปัญหา CORS ของ Google
            body: JSON.stringify(data) 
        })
        .then(res => res.text()) // อ่านค่าตอบกลับเป็น Text ก่อน
        .then(result => {
             // 4. เมื่อสำเร็จ
             alert("บันทึกเรียบร้อย!");
             form.reset(); // ล้างฟอร์ม
        })
        .catch(err => {
             console.error(err);
             alert("เกิดข้อผิดพลาด ดูที่ Console");
        })
        .finally(() => {
             // คืนค่าปุ่มให้กดได้ใหม่
             btn.innerText = 'บันทึกข้อมูล';
             btn.disabled = false;
        });
    });
</script>
